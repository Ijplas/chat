(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[56],{2931:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/channels/[id]",function(){return t(2758)}])},1551:function(e,n,t){"use strict";function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a=[],i=!0,l=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(u){l=!0,o=u}finally{try{i||null==t.return||t.return()}finally{if(l)throw o}}return a}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return r(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,i=(a=t(7294))&&a.__esModule?a:{default:a},l=t(1003),u=t(880),s=t(9246);var c={};function f(e,n,t,r){if(e&&l.isLocalURL(n)){e.prefetch(n,t,r).catch((function(e){0}));var o=r&&"undefined"!==typeof r.locale?r.locale:e&&e.locale;c[n+"%"+t+(o?"%"+o:"")]=!0}}var d=function(e){var n,t=!1!==e.prefetch,r=u.useRouter(),a=i.default.useMemo((function(){var n=o(l.resolveHref(r,e.href,!0),2),t=n[0],a=n[1];return{href:t,as:e.as?l.resolveHref(r,e.as):a||t}}),[r,e.href,e.as]),d=a.href,h=a.as,v=i.default.useRef(d),p=i.default.useRef(h),m=e.children,y=e.replace,x=e.shallow,g=e.scroll,b=e.locale;"string"===typeof m&&(m=i.default.createElement("a",null,m));var j=(n=i.default.Children.only(m))&&"object"===typeof n&&n.ref,w=o(s.useIntersection({rootMargin:"200px"}),3),N=w[0],C=w[1],k=w[2],_=i.default.useCallback((function(e){p.current===h&&v.current===d||(k(),p.current=h,v.current=d),N(e),j&&("function"===typeof j?j(e):"object"===typeof j&&(j.current=e))}),[h,j,d,k,N]);i.default.useEffect((function(){var e=C&&t&&l.isLocalURL(d),n="undefined"!==typeof b?b:r&&r.locale,o=c[d+"%"+h+(n?"%"+n:"")];e&&!o&&f(r,d,h,{locale:n})}),[h,d,C,b,t,r]);var E={ref:_,onClick:function(e){n.props&&"function"===typeof n.props.onClick&&n.props.onClick(e),e.defaultPrevented||function(e,n,t,r,o,a,i,u){("A"!==e.currentTarget.nodeName.toUpperCase()||!function(e){var n=e.currentTarget.target;return n&&"_self"!==n||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)&&l.isLocalURL(t))&&(e.preventDefault(),n[o?"replace":"push"](t,r,{shallow:a,locale:u,scroll:i}))}(e,r,d,h,y,x,g,b)},onMouseEnter:function(e){n.props&&"function"===typeof n.props.onMouseEnter&&n.props.onMouseEnter(e),l.isLocalURL(d)&&f(r,d,h,{priority:!0})}};if(e.passHref||"a"===n.type&&!("href"in n.props)){var I="undefined"!==typeof b?b:r&&r.locale,L=r&&r.isLocaleDomain&&l.getDomainLocale(h,I,r&&r.locales,r&&r.domainLocales);E.href=L||l.addBasePath(l.addLocale(h,I,r&&r.defaultLocale))}return i.default.cloneElement(n,E)};n.default=d,("function"===typeof n.default||"object"===typeof n.default&&null!==n.default)&&(Object.assign(n.default,n),e.exports=n.default)},9246:function(e,n,t){"use strict";function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function o(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a=[],i=!0,l=!1;try{for(t=t.call(e);!(i=(r=t.next()).done)&&(a.push(r.value),!n||a.length!==n);i=!0);}catch(u){l=!0,o=u}finally{try{i||null==t.return||t.return()}finally{if(l)throw o}}return a}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return r(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}Object.defineProperty(n,"__esModule",{value:!0}),n.useIntersection=function(e){var n=e.rootRef,t=e.rootMargin,r=e.disabled||!l,c=a.useRef(),f=o(a.useState(!1),2),d=f[0],h=f[1],v=o(a.useState(n?n.current:null),2),p=v[0],m=v[1],y=a.useCallback((function(e){c.current&&(c.current(),c.current=void 0),r||d||e&&e.tagName&&(c.current=function(e,n,t){var r=function(e){var n,t={root:e.root||null,margin:e.rootMargin||""},r=s.find((function(e){return e.root===t.root&&e.margin===t.margin}));r?n=u.get(r):(n=u.get(t),s.push(t));if(n)return n;var o=new Map,a=new IntersectionObserver((function(e){e.forEach((function(e){var n=o.get(e.target),t=e.isIntersecting||e.intersectionRatio>0;n&&t&&n(t)}))}),e);return u.set(t,n={id:t,observer:a,elements:o}),n}(t),o=r.id,a=r.observer,i=r.elements;return i.set(e,n),a.observe(e),function(){if(i.delete(e),a.unobserve(e),0===i.size){a.disconnect(),u.delete(o);var n=s.findIndex((function(e){return e.root===o.root&&e.margin===o.margin}));n>-1&&s.splice(n,1)}}}(e,(function(e){return e&&h(e)}),{root:p,rootMargin:t}))}),[r,p,t,d]),x=a.useCallback((function(){h(!1)}),[]);return a.useEffect((function(){if(!l&&!d){var e=i.requestIdleCallback((function(){return h(!0)}));return function(){return i.cancelIdleCallback(e)}}}),[d]),a.useEffect((function(){n&&m(n.current)}),[n]),[y,d,x]};var a=t(7294),i=t(4686),l="undefined"!==typeof IntersectionObserver;var u=new Map,s=[];("function"===typeof n.default||"object"===typeof n.default&&null!==n.default)&&(Object.assign(n.default,n),e.exports=n.default)},2758:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return g}});var r=t(4051),o=t.n(r),a=t(5893),i=t(1664),l=t.n(i),u=t(7294),s=t(4621),c=t(464),f=function(e){var n=e.size,t=void 0===n?16:n;return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2",children:[(0,a.jsx)("polyline",{points:"3 6 5 6 21 6"}),(0,a.jsx)("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),(0,a.jsx)("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),(0,a.jsx)("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})};function d(e,n,t,r,o,a,i){try{var l=e[a](i),u=l.value}catch(s){return void t(s)}l.done?n(u):Promise.resolve(u).then(r,o)}function h(e){var n=(0,u.useContext)(s.Z),t=n.signOut,r=n.user,i=function(){var e,n=(e=o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=prompt("Please enter your name"))&&(0,c.mR)(n.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),r.id);case 2:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){d(a,r,o,i,l,"next",e)}function l(e){d(a,r,o,i,l,"throw",e)}i(void 0)}))});return function(){return n.apply(this,arguments)}}();return(0,a.jsxs)("main",{className:"main flex h-screen w-screen overflow-hidden",children:[(0,a.jsx)("nav",{className:"w-64 bg-gray-900 text-gray-100 overflow-scroll ",style:{maxWidth:"20%",minWidth:150,maxHeight:"100vh"},children:(0,a.jsxs)("div",{className:"p-2 ",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("button",{className:"bg-blue-900 hover:bg-blue-800 text-white py-2 px-4 rounded w-full transition duration-150",onClick:function(){return i()},children:"New Channel"})}),(0,a.jsx)("hr",{className:"m-2"}),(0,a.jsxs)("div",{className:"p-2 flex flex-col space-y-2",children:[(0,a.jsx)("h6",{className:"text-xs",children:null===r||void 0===r?void 0:r.email}),(0,a.jsx)("button",{className:"bg-blue-900 hover:bg-blue-800 text-white py-2 px-4 rounded w-full transition duration-150",onClick:function(){return t()},children:"Log out"})]}),(0,a.jsx)("hr",{className:"m-2"}),(0,a.jsx)("h4",{className:"font-bold",children:"Channels"}),(0,a.jsx)("ul",{className:"channel-list",children:e.channels.map((function(n){return(0,a.jsx)(v,{channel:n,isActiveChannel:n.id===e.activeChannelId,user:r},n.id)}))})]})}),(0,a.jsx)("div",{className:"flex-1 bg-gray-800 h-screen",children:e.children})]})}var v=function(e){var n=e.channel,t=e.isActiveChannel,r=e.user;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsx)(l(),{href:"/channels/[id]",as:"/channels/".concat(n.id),children:(0,a.jsx)("a",{className:t?"font-bold":"",children:n.slug})}),1!==n.id&&(n.created_by===(null===r||void 0===r?void 0:r.id)||"admin"===(null===r||void 0===r?void 0:r.appRole))&&(0,a.jsx)("button",{onClick:function(){return(0,c.zz)(n.id)},children:(0,a.jsx)(f,{})})]})})},p=function(e){var n,t=e.message,r=(0,u.useContext)(s.Z).user;return(0,a.jsxs)("div",{className:"py-1 flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"text-gray-100 w-4",children:((null===r||void 0===r?void 0:r.id)===t.user_id||["admin","moderator"].includes(null===r||void 0===r?void 0:r.appRole))&&(0,a.jsx)("button",{onClick:function(){return(0,c.$Z)(t.id)},children:(0,a.jsx)(f,{})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-blue-700 font-bold",children:null===t||void 0===t||null===(n=t.author)||void 0===n?void 0:n.username}),(0,a.jsx)("p",{className:"text-white",children:t.message})]})]})},m=function(e){var n=e.onSubmit,t=(0,u.useState)(""),r=t[0],o=t[1];return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",placeholder:"Send a message",value:r,onChange:function(e){return o(e.target.value)},onKeyDown:function(e){13===e.keyCode&&(n(r),o(""))}})})},y=t(1163);function x(e,n,t,r,o,a,i){try{var l=e[a](i),u=l.value}catch(s){return void t(s)}l.done?n(u):Promise.resolve(u).then(r,o)}var g=function(e){var n=(0,y.useRouter)(),t=(0,u.useContext)(s.Z),r=t.user,i=(t.authLoaded,t.signOut,(0,u.useRef)(null)),l=n.query.id,f=(0,c.oR)({channelId:l}),d=f.messages,v=f.channels;return(0,u.useEffect)((function(){i.current.scrollIntoView({block:"start",behavior:"smooth"})}),[d]),(0,u.useEffect)((function(){v.some((function(e){return e.id===Number(l)}))||n.push("/channels/1")}),[v,l]),(0,a.jsx)(h,{channels:v,activeChannelId:l,children:(0,a.jsxs)("div",{className:"relative h-screen",children:[(0,a.jsx)("div",{className:"Messages h-full pb-16",children:(0,a.jsxs)("div",{className:"p-2 overflow-y-auto",children:[d.map((function(e){return(0,a.jsx)(p,{message:e},e.id)})),(0,a.jsx)("div",{ref:i,style:{height:0}})]})}),(0,a.jsx)("div",{className:"p-2 absolute bottom-0 left-0 w-full",children:(0,a.jsx)(m,{onSubmit:function(){var e,n=(e=o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.Hz)(n,l,r.id));case 1:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var a=e.apply(n,t);function i(e){x(a,r,o,i,l,"next",e)}function l(e){x(a,r,o,i,l,"throw",e)}i(void 0)}))});return function(e){return n.apply(this,arguments)}}()})})]})})}},1664:function(e,n,t){e.exports=t(1551)}},function(e){e.O(0,[774,888,179],(function(){return n=2931,e(e.s=n);var n}));var n=e.O();_N_E=n}]);